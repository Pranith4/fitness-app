<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProChallenge Hub – Sign In</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet" />
  <style>
    /* ─── RESET & ROOT ─────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg0:  #0d1117;
      --bg1:  #161b27;
      --bg2:  #1c2236;
      --green: #00ff88;
      --cyan:  #00d2ff;
      --muted: #5a6882;
      --sub:   #8b9ab5;
      --white: #ffffff;
      --red:   #ff3b5c;
      --border: rgba(255,255,255,0.08);
      --glow-g: 0 0 24px rgba(0,255,136,0.35);
      --glow-c: 0 0 24px rgba(0,210,255,0.35);
      --tab-h: 50px;
      --radius: 18px;
    }

    /* ─── BODY / BACKGROUND ────────────────────────────────── */
    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--bg0);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
      position: relative;
    }

    /* animated grid */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(0,210,255,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,210,255,0.025) 1px, transparent 1px);
      background-size: 48px 48px;
      animation: gridScroll 25s linear infinite;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes gridScroll {
      from { transform: translate(0,0); }
      to   { transform: translate(48px,48px); }
    }

    /* radial glows */
    body::after {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 60% 50% at 15% 10%, rgba(0,210,255,0.07) 0%, transparent 60%),
        radial-gradient(ellipse 50% 40% at 85% 90%, rgba(0,255,136,0.06) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    /* floating particles */
    .particle {
      position: fixed;
      width: 3px; height: 3px;
      border-radius: 50%;
      background: var(--cyan);
      opacity: 0;
      animation: drift var(--dur,18s) var(--delay,0s) ease-in-out infinite;
      pointer-events: none; z-index: 0;
    }
    @keyframes drift {
      0%   { opacity: 0; transform: translate(0, 0); }
      20%  { opacity: 0.4; }
      80%  { opacity: 0.3; }
      100% { opacity: 0; transform: translate(var(--dx,60px), var(--dy,-80px)); }
    }

    /* ─── CARD ─────────────────────────────────────────────── */
    .card {
      position: relative; z-index: 1;
      width: 100%; max-width: 440px;
      background: linear-gradient(145deg, var(--bg2) 0%, var(--bg1) 100%);
      border: 1.5px solid var(--border);
      border-radius: 24px;
      padding: 44px 38px 40px;
      box-shadow:
        0 25px 70px rgba(0,0,0,0.6),
        0 0 0 1px rgba(0,210,255,0.06),
        inset 0 1px 0 rgba(255,255,255,0.04);
      animation: riseIn 0.55s cubic-bezier(0.22,1,0.36,1) both;
    }
    @keyframes riseIn {
      from { opacity:0; transform:translateY(32px) scale(0.97); }
      to   { opacity:1; transform:translateY(0)    scale(1); }
    }

    /* top glow accent line */
    .card::before {
      content: '';
      position: absolute; top: 0; left: 10%; right: 10%; height: 1px;
      background: linear-gradient(90deg, transparent, var(--cyan), var(--green), transparent);
      border-radius: 50%;
      opacity: 0.6;
    }

    /* ─── LOGO ─────────────────────────────────────────────── */
    .logo-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-bottom: 32px;
    }

    .logo-icon {
      width: 58px; height: 58px;
      background: linear-gradient(135deg, #1a2a1a 0%, #0d1f2d 100%);
      border: 2px solid rgba(0,255,136,0.3);
      border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 26px;
      box-shadow: 0 0 30px rgba(0,255,136,0.2), inset 0 1px 0 rgba(255,255,255,0.05);
      animation: iconPulse 3s ease-in-out infinite;
    }
    @keyframes iconPulse {
      0%,100% { box-shadow: 0 0 20px rgba(0,255,136,0.2); }
      50%      { box-shadow: 0 0 35px rgba(0,255,136,0.45); }
    }

    .logo-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: 2px;
    }
    .logo-text .pro  { color: var(--white); }
    .logo-text .chal { color: var(--green); }

    .logo-sub {
      color: var(--sub);
      font-size: 1rem;
      font-weight: 500;
      letter-spacing: 0.5px;
      margin-top: -8px;
    }

    /* ─── TABS ─────────────────────────────────────────────── */
    .tabs {
      display: flex;
      background: rgba(0,0,0,0.3);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 30px;
      gap: 4px;
    }

    .tab-btn {
      flex: 1;
      height: var(--tab-h);
      border: none;
      border-radius: 9px;
      background: transparent;
      color: var(--sub);
      font-family: 'Rajdhani', sans-serif;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.28s ease;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, rgba(0,210,255,0.15) 0%, rgba(0,255,136,0.12) 100%);
      color: var(--white);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
    }

    .tab-btn:not(.active):hover {
      color: var(--white);
      background: rgba(255,255,255,0.04);
    }

    /* ─── FORM PANELS ──────────────────────────────────────── */
    .panel { display: none; }
    .panel.active {
      display: block;
      animation: fadeSlide 0.3s ease both;
    }
    @keyframes fadeSlide {
      from { opacity:0; transform:translateX(8px); }
      to   { opacity:1; transform:translateX(0); }
    }

    /* ─── FORM ELEMENTS ────────────────────────────────────── */
    .field { margin-bottom: 18px; }

    .field label {
      display: block;
      font-size: 0.78rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--sub);
      margin-bottom: 8px;
    }

    .field input {
      width: 100%;
      padding: 14px 18px;
      border-radius: 11px;
      border: 1.5px solid var(--border);
      background: rgba(0,0,0,0.35);
      color: var(--white);
      font-family: 'Rajdhani', sans-serif;
      font-size: 1.05rem;
      font-weight: 500;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      outline: none;
    }

    .field input::placeholder { color: var(--muted); }

    .field input:focus {
      border-color: var(--cyan);
      background: rgba(0,0,0,0.5);
      box-shadow: var(--glow-c);
    }

    /* two fields side by side */
    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

    /* ─── SUBMIT BUTTON ────────────────────────────────────── */
    .submit-btn {
      width: 100%;
      padding: 16px;
      margin-top: 8px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--green) 100%);
      color: #000;
      font-family: 'Rajdhani', sans-serif;
      font-size: 1.15rem;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: var(--glow-g);
      transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 32px rgba(0,255,136,0.5);
    }

    .submit-btn:active:not(:disabled) { transform: translateY(-1px); }

    .submit-btn:disabled {
      filter: brightness(0.55);
      cursor: not-allowed;
      transform: none;
    }

    /* spinner inside button */
    .spin {
      width: 18px; height: 18px;
      border: 2.5px solid rgba(0,0,0,0.3);
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ─── ALERTS ───────────────────────────────────────────── */
    .alert {
      display: none;
      padding: 13px 16px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 18px;
      animation: shake 0.4s ease;
    }
    @keyframes shake {
      0%,100%{ transform:translateX(0); }
      25%    { transform:translateX(-8px); }
      75%    { transform:translateX(8px); }
    }

    .alert.error {
      background: rgba(255,59,92,0.12);
      border: 1.5px solid rgba(255,59,92,0.35);
      color: var(--red);
    }

    .alert.success {
      background: rgba(0,255,136,0.1);
      border: 1.5px solid rgba(0,255,136,0.3);
      color: var(--green);
      animation: none;
    }

    /* ─── SUCCESS STATE (Register) ─────────────────────────── */
    .success-screen {
      display: none;
      text-align: center;
      padding: 20px 0 10px;
      animation: riseIn 0.5s ease both;
    }

    .success-screen .check {
      width: 72px; height: 72px;
      background: linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,210,255,0.1));
      border: 2px solid var(--green);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 32px;
      margin: 0 auto 20px;
      box-shadow: var(--glow-g);
      animation: iconPulse 2.5s ease-in-out infinite;
    }

    .success-screen h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      color: var(--green);
      margin-bottom: 10px;
    }

    .success-screen p {
      color: var(--sub);
      font-size: 1rem;
      line-height: 1.6;
      max-width: 300px;
      margin: 0 auto 24px;
    }

    .back-link {
      color: var(--cyan);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
      background: none;
      border: none;
      font-family: 'Rajdhani', sans-serif;
    }

    /* ─── FOOTER NOTE ──────────────────────────────────────── */
    .note {
      text-align: center;
      color: var(--muted);
      font-size: 0.85rem;
      margin-top: 22px;
    }

    /* ─── RESPONSIVE ───────────────────────────────────────── */
    @media (max-width: 480px) {
      .card { padding: 34px 24px 30px; }
      .logo-text { font-size: 1.65rem; }
      .field-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- Floating particles -->
<div class="particle" style="--dur:20s;--delay:0s;  --dx:80px; --dy:-120px; top:25%;  left:8%;"></div>
<div class="particle" style="--dur:16s;--delay:3s;  --dx:-60px;--dy:-90px;  top:70%;  left:85%;"></div>
<div class="particle" style="--dur:22s;--delay:6s;  --dx:50px; --dy:-70px;  top:55%;  left:20%;"></div>
<div class="particle" style="--dur:18s;--delay:1.5s;--dx:-40px;--dy:-100px; top:15%;  left:75%;"></div>
<div class="particle" style="--dur:14s;--delay:9s;  --dx:70px; --dy:-60px;  top:85%;  left:40%;"></div>

<div class="card">

  <!-- Logo -->
  <div class="logo-wrap">
    <div class="logo-icon">⚡</div>
    <div>
      <div class="logo-text"><span class="pro">Pro</span><span class="chal">Challenge</span></div>
      <div class="logo-sub">Your daily performance hub</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" id="tab-signin" onclick="switchTab('signin')">Sign In</button>
    <button class="tab-btn"        id="tab-register" onclick="switchTab('register')">Register</button>
  </div>

  <!-- ══════════════ SIGN IN PANEL ══════════════ -->
  <div class="panel active" id="panel-signin">

    <div class="alert error" id="signin-error"></div>

    <div class="field">
      <label>Username</label>
      <input type="text" id="si-username" placeholder="enter username" autocomplete="username" />
    </div>

    <div class="field">
      <label>Password</label>
      <input type="password" id="si-password" placeholder="••••••••" autocomplete="current-password" onkeydown="if(event.key==='Enter') doSignIn()" />
    </div>

    <button class="submit-btn" id="signin-btn" onclick="doSignIn()">
      <span class="spin" id="signin-spin"></span>
      <span id="signin-label">Sign In →</span>
    </button>

    <p class="note">Don't have an account? <span style="color:var(--cyan);cursor:pointer;font-weight:700;" onclick="switchTab('register')">Register here</span></p>
  </div>

  <!-- ══════════════ REGISTER PANEL ══════════════ -->
  <div class="panel" id="panel-register">

    <!-- Form view -->
    <div id="reg-form-view">

      <div class="alert error"   id="reg-error"></div>
      <div class="alert success" id="reg-info"></div>

      <div class="field-row">
        <div class="field">
          <label>First Name</label>
          <input type="text" id="reg-firstname" placeholder="John" />
        </div>
        <div class="field">
          <label>Last Name</label>
          <input type="text" id="reg-lastname" placeholder="Doe" />
        </div>
      </div>

      <div class="field">
        <label>Email Address</label>
        <input type="email" id="reg-email" placeholder="john@example.com" />
      </div>

      <div class="field">
        <label>Phone Number</label>
        <input type="tel" id="reg-phone" placeholder="+1 555 000 0000" />
      </div>

      <div class="field">
        <label>Username</label>
        <input type="text" id="reg-username" placeholder="choose a username" autocomplete="username" />
      </div>

      <div class="field-row">
        <div class="field">
          <label>Password</label>
          <input type="password" id="reg-password" placeholder="••••••••" autocomplete="new-password" />
        </div>
        <div class="field">
          <label>Confirm</label>
          <input type="password" id="reg-confirm" placeholder="••••••••" autocomplete="new-password" onkeydown="if(event.key==='Enter') doRegister()" />
        </div>
      </div>

      <button class="submit-btn" id="register-btn" onclick="doRegister()">
        <span class="spin" id="register-spin"></span>
        <span id="register-label">Create Account →</span>
      </button>

      <p class="note">Already have an account? <span style="color:var(--cyan);cursor:pointer;font-weight:700;" onclick="switchTab('signin')">Sign In</span></p>

    </div>

    <!-- Success view -->
    <div class="success-screen" id="reg-success-view">
      <div class="check">✓</div>
      <h3>You're on the list!</h3>
      <p>Your details have been submitted. We'll review your application and activate your account shortly.</p>
      <button class="back-link" onclick="switchTab('signin')">← Back to Sign In</button>
    </div>

  </div>
  <!-- end register panel -->

</div><!-- .card -->

<script>
  // ─── CONFIG ────────────────────────────────────────────────────────────────
  // Replace with your deployed Google Apps Script web app URL
  const GAS_URL = "https://script.google.com/macros/s/AKfycbzwWrCRjHYeJA0-5SHxAamG-H96m5ItJzOXtNhgu0sy43xIlkCPLTeayK6bKT1-S9-Raw/exec";

  // ─── TAB SWITCHING ──────────────────────────────────────────────────────────
  function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
    document.getElementById('panel-' + tab).classList.add('active');
    clearAlerts();
  }

  function clearAlerts() {
    document.querySelectorAll('.alert').forEach(el => {
      el.style.display = 'none';
      el.textContent = '';
    });
  }

  // ─── ALERT HELPERS ──────────────────────────────────────────────────────────
  function showError(id, msg) {
    const el = document.getElementById(id);
    el.textContent = msg;
    el.style.display = 'block';
    el.className = 'alert error';
  }

  function showInfo(id, msg) {
    const el = document.getElementById(id);
    el.textContent = msg;
    el.style.display = 'block';
    el.className = 'alert success';
  }

  // ─── BUTTON LOADING ─────────────────────────────────────────────────────────
  function setLoading(btnId, spinId, labelId, loading, labelText) {
    const btn   = document.getElementById(btnId);
    const spin  = document.getElementById(spinId);
    const label = document.getElementById(labelId);
    btn.disabled = loading;
    spin.style.display  = loading ? 'block' : 'none';
    label.textContent   = loading ? 'Please wait...' : labelText;
  }

  // ─── SIGN IN ────────────────────────────────────────────────────────────────
  async function doSignIn() {
    clearAlerts();
    const username = document.getElementById('si-username').value.trim();
    const password = document.getElementById('si-password').value;

    if (!username || !password) {
      showError('signin-error', 'Please enter your username and password.');
      return;
    }

    setLoading('signin-btn', 'signin-spin', 'signin-label', true, 'Sign In →');

    try {
      const res  = await fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'authenticate', username, password })
      });
      const data = await res.json();

      if (data.success) {
        localStorage.setItem('isAuthenticated', 'true');
        localStorage.setItem('loginTime', Date.now());
        localStorage.setItem('user', data.username || username);
        window.location.href = 'dashboard.html';
      } else {
        showError('signin-error', data.message || 'Invalid username or password.');
      }
    } catch (err) {
      showError('signin-error', 'Connection error. Please try again.');
    } finally {
      setLoading('signin-btn', 'signin-spin', 'signin-label', false, 'Sign In →');
    }
  }

  // ─── REGISTER ───────────────────────────────────────────────────────────────
  async function doRegister() {
    clearAlerts();

    const firstName = document.getElementById('reg-firstname').value.trim();
    const lastName  = document.getElementById('reg-lastname').value.trim();
    const email     = document.getElementById('reg-email').value.trim();
    const phone     = document.getElementById('reg-phone').value.trim();
    const username  = document.getElementById('reg-username').value.trim();
    const password  = document.getElementById('reg-password').value;
    const confirm   = document.getElementById('reg-confirm').value;

    // ── Validation ──
    if (!firstName || !lastName) {
      showError('reg-error', 'Please enter your first and last name.'); return;
    }
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showError('reg-error', 'Please enter a valid email address.'); return;
    }
    if (!phone) {
      showError('reg-error', 'Please enter your phone number.'); return;
    }
    if (!username || username.length < 3) {
      showError('reg-error', 'Username must be at least 3 characters.'); return;
    }
    if (!password || password.length < 6) {
      showError('reg-error', 'Password must be at least 6 characters.'); return;
    }
    if (password !== confirm) {
      showError('reg-error', 'Passwords do not match.'); return;
    }

    setLoading('register-btn', 'register-spin', 'register-label', true, 'Create Account →');

    try {
      // 1️⃣  Create the user account (existing action in Apps Script)
      const res  = await fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({
          action:   'registerUser',
          username,
          password,
          email,
          fullName: `${firstName} ${lastName}`,
          phone
        })
      });
      const data = await res.json();

      if (!data.success) {
        showError('reg-error', data.message || 'Registration failed. Please try again.');
        return;
      }

      // 2️⃣  Also save full details to REGISTRATIONS_PENDING sheet for admin review
      await fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({
          action:    'savePendingRegistration',
          username,
          fullName:  `${firstName} ${lastName}`,
          email,
          phone,
          submittedAt: new Date().toISOString()
        })
      });

      // Show success screen
      document.getElementById('reg-form-view').style.display   = 'none';
      document.getElementById('reg-success-view').style.display = 'block';

    } catch (err) {
      showError('reg-error', 'Connection error. Please try again.');
    } finally {
      setLoading('register-btn', 'register-spin', 'register-label', false, 'Create Account →');
    }
  }

  // ─── AUTO REDIRECT IF ALREADY LOGGED IN ────────────────────────────────────
  (function () {
    const auth      = localStorage.getItem('isAuthenticated');
    const loginTime = parseInt(localStorage.getItem('loginTime') || '0', 10);
    const hours     = (Date.now() - loginTime) / 3600000;
    if (auth === 'true' && hours < 24) window.location.href = 'dashboard.html';
  })();
</script>

</body>
</html>