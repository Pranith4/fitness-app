<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
<h1 id="welcome"></h1>

<div class="card">
<input id="weight" placeholder="Enter weight">
<button onclick="addWeight()">Submit</button>
<p id="msg"></p>
</div>

<div class="card">
<canvas id="dailyChart"></canvas>
</div>

<div class="card">
<canvas id="monthlyChart"></canvas>
</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzwWrCRjHYeJA0-5SHxAamG-H96m5ItJzOXtNhgu0sy43xIlkCPLTeayK6bKT1-S9-Raw/exec";
const user=localStorage.getItem("user");
if(!user) window.location="index.html";
welcome.innerText="Welcome "+user;

async function loadData(){
const res=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"getWeights",username:user})});
const data=await res.json();

if(data.length<=1){
msg.innerText="Enter weights to see progress";
return;
}

const dates=data.slice(1).map(r=>new Date(r[1]).toLocaleDateString());
const weights=data.slice(1).map(r=>r[2]);

new Chart(document.getElementById("dailyChart"),{
type:"line",
data:{labels:dates,datasets:[{label:"Daily Weight",data:weights,borderWidth:2}]}
});

let monthMap={};
data.slice(1).forEach(r=>{
let m=new Date(r[1]).toLocaleString('default',{month:'short'});
monthMap[m]=(monthMap[m]||0)+parseFloat(r[2]);
});

new Chart(document.getElementById("monthlyChart"),{
type:"bar",
data:{labels:Object.keys(monthMap),datasets:[{label:"Monthly Total",data:Object.values(monthMap)}]}
});
}

async function addWeight(){
const res=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"addWeight",username:user,weight:weight.value})});
const d=await res.json();
msg.innerText=d.success?`Submitted at ${new Date(d.timestamp).toLocaleString()}`:d.message;
loadData();
}

loadData();
</script>
</body>
</html>
